# ماژول WHMCS پارس‌پک

ماژول پروویژنینگ WHMCS برای فروش و مدیریت خودکار سرورهای مجازی پارس‌پک

## نصب

### مرحله 1: آپلود فایل‌ها

1. فایل `parspack.php` را در مسیر زیر قرار دهید:
```
/modules/servers/parspack/parspack.php
```

2. پوشه `templates` را در همان مسیر ایجاد کرده و فایل `clientarea.tpl` را در آن قرار دهید:
```
/modules/servers/parspack/templates/clientarea.tpl
```

### مرحله 2: ایجاد فیلدهای سفارشی

در بخش **Setup > Custom Fields** یک فیلد سفارشی برای محصولات با مشخصات زیر ایجاد کنید:

- **Field Name**: `server_id`
- **Field Type**: Text Box
- **Description**: شناسه سرور در پارس‌پک
- **Admin Only**: بله

### مرحله 3: تنظیم سرور

1. به **Setup > Products/Services > Servers** بروید
2. روی **Add New Server** کلیک کنید
3. اطلاعات زیر را وارد کنید:
   - **Name**: نام دلخواه (مثلاً "Parspack Cloud")
   - **Hostname**: api.parspack.com
   - **IP Address**: (اختیاری)
   - **Type**: Parspack Cloud Server
   - **Access Hash**: توکن API خود را از پنل پارس‌پک وارد کنید
4. روی **Test Connection** کلیک کنید تا اتصال تست شود
5. **Save Changes**

### مرحله 4: ایجاد محصول

1. به **Setup > Products/Services > Products/Services** بروید
2. یک محصول جدید ایجاد کنید
3. در تب **Module Settings**:
   - **Module Name**: Parspack Cloud Server
   - **Server Group**: سرور پارس‌پک که در مرحله قبل ساختید را انتخاب کنید
   
4. **Configurable Options** را تنظیم کنید:
   - **شناسه پلن**: ID پلن مورد نظر از پنل پارس‌پک (مثلاً: `c2-m2-d40`)
   - **شناسه سیستم عامل**: ID سیستم عامل (مثلاً: `ubuntu-22.04`)
   - **منطقه دیتاسنتر**: `ir-thr-ba1` یا `ir-thr-mn1`
   - **پشتیبان‌گیری خودکار**: فعال/غیرفعال

5. تنظیمات قیمت را انجام دهید و محصول را ذخیره کنید

## دریافت اطلاعات API

### دریافت توکن API

1. وارد پنل پارس‌پک شوید: https://panel.parspack.com
2. به بخش **API** بروید
3. یک توکن جدید ایجاد کنید
4. توکن را کپی کرده و در تنظیمات سرور WHMCS وارد کنید

### دریافت شناسه پلن‌ها

برای مشاهده لیست پلن‌های موجود می‌توانید از API استفاده کنید:

```bash
curl -X GET "https://api.parspack.com/v1/cloud/plan" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

نمونه شناسه پلن‌ها:
- `c1-m1-d25` - 1 Core, 1GB RAM, 25GB Disk
- `c2-m2-d40` - 2 Core, 2GB RAM, 40GB Disk
- `c4-m4-d80` - 4 Core, 4GB RAM, 80GB Disk

### دریافت شناسه سیستم‌عامل‌ها

```bash
curl -X GET "https://api.parspack.com/v1/cloud/os" \
  -H "Authorization: Bearer YOUR_API_TOKEN"
```

نمونه شناسه سیستم‌عامل‌ها:
- `ubuntu-22.04` - Ubuntu 22.04 LTS
- `ubuntu-20.04` - Ubuntu 20.04 LTS
- `debian-11` - Debian 11
- `centos-8` - CentOS 8

## قابلیت‌های ماژول

### قابلیت‌های اتوماتیک

- ✅ ایجاد خودکار سرور هنگام فعال‌سازی سفارش
- ✅ تعلیق (خاموش کردن) سرور هنگام تعلیق سرویس
- ✅ فعال‌سازی (روشن کردن) سرور هنگام رفع تعلیق
- ✅ حذف سرور هنگام پایان سرویس
- ✅ ذخیره خودکار IP و رمز عبور

### دکمه‌های پنل مدیریت (Admin Area)

- 🔄 **راه‌اندازی مجدد**: Reboot سرور
- 📊 **دریافت اطلاعات**: بروزرسانی اطلاعات سرور
- 🔑 **بازیابی رمز عبور**: تولید رمز عبور جدید

### دکمه‌های ناحیه کاربری (Client Area)

- 🔄 **راه‌اندازی مجدد**: Reboot سرور
- ⏸️ **خاموش کردن**: Shutdown سرور
- ▶️ **روشن کردن**: Power On سرور

### اطلاعات نمایش داده شده

- نام سرور
- وضعیت فعلی (در حال اجرا، متوقف، در حال ساخت)
- آدرس IP
- مشخصات سخت‌افزاری (CPU, RAM, Disk)
- سیستم عامل
- منطقه دیتاسنتر
- اطلاعات دسترسی SSH

## استفاده از فیلدهای سفارشی اختیاری

می‌توانید فیلد سفارشی اضافی برای دریافت کلید SSH از مشتری ایجاد کنید:

- **Field Name**: `ssh_key`
- **Field Type**: Text Area
- **Description**: کلید عمومی SSH (اختیاری)
- **Admin Only**: خیر

## عیب‌یابی

### بررسی لاگ‌ها

لاگ‌های ماژول در بخش **Utilities > Logs > Module Log** قابل مشاهده هستند.

### مشکلات رایج

**خطای اتصال به API:**
- بررسی کنید توکن API معتبر باشد
- اطمینان حاصل کنید سرور WHMCS به اینترنت دسترسی دارد
- فایروال یا Firewall را بررسی کنید

**سرور ایجاد نمی‌شود:**
- شناسه پلن و سیستم‌عامل را بررسی کنید
- از معتبر بودن پلن در منطقه انتخابی اطمینان حاصل کنید
- موجودی حساب پارس‌پک را چک کنید

**رمز عبور نمایش داده نمی‌شود:**
- اطمینان حاصل کنید رمزنگاری WHMCS فعال است
- دسترسی‌های دیتابیس را بررسی کنید

## امنیت

- توکن API در فیلد Access Hash رمزنگاری شده ذخیره می‌شود
- رمز عبور سرورها با تابع `encrypt()` رمزنگاری می‌شوند
- تمام درخواست‌های API از HTTPS استفاده می‌کنند
- اطلاعات حساس در لاگ‌ها ثبت نمی‌شوند

## پشتیبانی

برای مشکلات مربوط به API پارس‌پک:
- مستندات: https://docs.parspack.com
- پشتیبانی: support@parspack.com

برای مشکلات ماژول WHMCS:
- لاگ ماژول را بررسی کنید
- نسخه WHMCS: 7.0 یا بالاتر
- نسخه PHP: 7.2 یا بالاتر

## نکات مهم

1. **زمان ساخت سرور**: ممکن است تا 2-5 دقیقه طول بکشد
2. **وضعیت Building**: سرور در حال ساخت است، لطفاً صبر کنید
3. **تغییر IP**: معمولاً بعد از اولین راه‌اندازی سرور تخصیص می‌یابد
4. **بکاپ خودکار**: در صورت فعال بودن، هفتگی انجام می‌شود

## به‌روزرسانی

برای به‌روزرسانی ماژول:

1. فایل `parspack.php` قدیمی را backup بگیرید
2. فایل جدید را جایگزین کنید
3. Cache WHMCS را پاک کنید
4. تست اتصال را مجدداً انجام دهید

## لایسنس

این ماژول تحت لایسنس WHMCS Eula منتشر شده است.

## نسخه

**Version**: 1.0.0  
**Last Updated**: 2025  
**Compatible with**: WHMCS 7.0+

---

**توجه**: این ماژول براساس مستندات رسمی API پارس‌پک (نسخه v1) نوشته شده است.